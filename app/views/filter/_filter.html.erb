<% cache_unless request.path_parameters.without(:controller, :action, :page, :code).any?, "filter" do %>
  <nav class="filter">
    <div class="filter__item">
      <span class="filter__label"><%= t "filter.categories" %></span>

      <div class="dropdown" data-dropdown>
        <%= link_to params[:category] ? params[:category].gsub("-", " ").split.map(&:capitalize).join(" ") : t("filter.select"), "#", class: "dropdown__toggle", data: { action: "toggle-dropdown" } %>

        <div class="dropdown__content" data-dropdown-content>
          <% if params[:category] %>
            <%= link_to t("filter.remove"), build_filter_path(:category, nil), class: "dropdown__item" %>
            <hr>
          <% end %>

          <% categories.each do |category| %>
            <%= link_to category, build_filter_path(:category, to_slug(category)), class: "dropdown__item" %>
          <% end %>
        </div>
      </div>
    </div>

    <div class="filter__item">
      <span class="filter__label"><%= t "filter.heroes" %></span>

      <div class="dropdown" data-dropdown>
        <%= link_to params[:hero] ? params[:hero].gsub("-", " ").split.map(&:capitalize).join(" ") : t("filter.select"), "#", class: "dropdown__toggle", data: { action: "toggle-dropdown" } %>

        <div class="dropdown__content" data-dropdown-content>
          <% if params[:hero] %>
            <%= link_to t("filter.remove"), build_filter_path(:hero, nil), class: "dropdown__item" %>
            <hr>
          <% end %>

          <% heroes.group_by { |item| item["category"] }.each do |hero_category, heroes| %>
            <span class="dropdown__label"><%= hero_category %></span>

            <% heroes.each do |hero| %>
              <% name = I18n.locale == I18n.default_locale ? hero["name"] : hero[I18n.locale.to_s] %>
              <%= link_to name, build_filter_path(:hero, to_slug(hero["name"])), class: "dropdown__item" %>
            <% end %>
          <% end %>
        </div>
      </div>
    </div>

    <div class="filter__item">
      <span class="filter__label"><%= t "filter.maps" %></span>

      <div class="dropdown" data-dropdown>
        <%= link_to params[:map] ? params[:map].gsub("-", " ").split.map(&:capitalize).join(" ") : t("filter.select"), "#", class: "dropdown__toggle", data: { action: "toggle-dropdown" } %>

        <div class="dropdown__content" data-dropdown-content>
          <% if params[:map] %>
            <%= link_to t("filter.remove"), build_filter_path(:map, nil), class: "dropdown__item" %>
            <hr>
          <% end %>

          <% maps.group_by { |item| item["type"] }.each do |map_type, maps| %>
            <span class="dropdown__label"><%= map_type %></span>

            <% maps.each do |map| %>
              <% name = I18n.locale == I18n.default_locale ? map["name"] : map[I18n.locale.to_s] %>
              <%= link_to name, build_filter_path(:map, to_slug(map["name"])), class: "dropdown__item" %>
            <% end %>
          <% end %>
        </div>
      </div>
    </div>

    <div class="filter__tray" data-toggle-content>
      <div data-role="content-to-toggle" style="<%= "display: none" if params[:from].nil? && params[:to].nil? && params[:sort].nil? && params[:expired].nil? && params[:author].nil? %>">
        <div class="filter">
          <div class="filter__item">
            <span class="filter__label"><%= t "filter.from" %></span>

            <div class="dropdown" data-dropdown>
              <%= link_to params[:from] ? time_ago_in_words(params[:from]).gsub("about", "") + " ago" : t("filter.select"), "#", class: "dropdown__toggle", data: { action: "toggle-dropdown" } %>

              <div class="dropdown__content" data-dropdown-content>
                <% if params[:from] %>
                  <%= link_to t("filter.remove"), build_filter_path(:from, nil), class: "dropdown__item" %>
                  <hr>
                <% end %>

                <%= link_to "1 day ago", build_filter_path(:from, 1.day.ago.strftime("%Y-%m-%d")), class: "dropdown__item" %>
                <%= link_to "3 days ago", build_filter_path(:from, 3.days.ago.strftime("%Y-%m-%d")), class: "dropdown__item" %>
                <%= link_to "7 days ago", build_filter_path(:from, 1.week.ago.strftime("%Y-%m-%d")), class: "dropdown__item" %>
                <%= link_to "1 month ago", build_filter_path(:from, 1.month.ago.strftime("%Y-%m-%d")), class: "dropdown__item" %>
                <%= link_to "3 months ago", build_filter_path(:from, 3.months.ago.strftime("%Y-%m-%d")), class: "dropdown__item" %>
                <%= link_to "6 months ago", build_filter_path(:from, 6.months.ago.strftime("%Y-%m-%d")), class: "dropdown__item" %>
                <%= link_to "1 year ago", build_filter_path(:from, 1.year.ago.strftime("%Y-%m-%d")), class: "dropdown__item" %>
              </div>
            </div>
          </div>

          <div class="filter__item">
            <span class="filter__label"><%= t "filter.to" %></span>

            <div class="dropdown" data-dropdown>
              <%= link_to params[:to] ? time_ago_in_words(params[:to]).gsub("about", "") + " ago" : t("filter.select"), "#", class: "dropdown__toggle", data: { action: "toggle-dropdown" } %>

              <div class="dropdown__content" data-dropdown-content>
                <% if params[:to] %>
                  <%= link_to t("filter.remove"), build_filter_path(:to, nil), class: "dropdown__item" %>
                  <hr>
                <% end %>

                <%= link_to "1 day ago", build_filter_path(:to, 1.day.ago.strftime("%Y-%m-%d")), class: "dropdown__item" %>
                <%= link_to "3 days ago", build_filter_path(:to, 3.days.ago.strftime("%Y-%m-%d")), class: "dropdown__item" %>
                <%= link_to "7 days ago", build_filter_path(:to, 1.week.ago.strftime("%Y-%m-%d")), class: "dropdown__item" %>
                <%= link_to "1 month ago", build_filter_path(:to, 1.month.ago.strftime("%Y-%m-%d")), class: "dropdown__item" %>
                <%= link_to "3 months ago", build_filter_path(:to, 3.months.ago.strftime("%Y-%m-%d")), class: "dropdown__item" %>
                <%= link_to "6 months ago", build_filter_path(:to, 6.months.ago.strftime("%Y-%m-%d")), class: "dropdown__item" %>
                <%= link_to "1 year ago", build_filter_path(:to, 1.year.ago.strftime("%Y-%m-%d")), class: "dropdown__item" %>
              </div>
            </div>
          </div>

          <div class="filter__item">
            <span class="filter__label"><%= t "filter.sort" %></span>

            <div class="dropdown" data-dropdown>
              <% if params[:search] && !params[:sort] %>
                <%= link_to "Relevancy", "#", class: "dropdown__toggle", data: { action: "toggle-dropdown" } %>
              <% else %>
                <%= link_to params[:sort] ? params[:sort].gsub("-", " ").humanize : t("filter.select"), "#", class: "dropdown__toggle", data: { action: "toggle-dropdown" } %>
              <% end %>

              <div class="dropdown__content" data-dropdown-content>
                <% if params[:sort] %>
                  <%= link_to t("filter.remove"), build_filter_path(:sort, nil), class: "dropdown__item" %>
                  <hr>
                <% end %>

                <%= link_to "Created", build_filter_path(:sort, "created"), class: "dropdown__item" %>
                <%= link_to "Updated", build_filter_path(:sort, "updated"), class: "dropdown__item" %>
                <%= link_to "On Fire", build_filter_path(:sort, "on-fire"), class: "dropdown__item" %>
                <%= link_to "Favorites", build_filter_path(:sort, "favorites"), class: "dropdown__item" %>
                <%= link_to "Views", build_filter_path(:sort, "views"), class: "dropdown__item" %>
              </div>
            </div>
          </div>

          <div class="filter__item">
            <span class="filter__label"><%= t "filter.exclude_expired" %></span>

            <div class="dropdown" data-dropdown>
              <%= link_to params[:expired] ? params[:expired].humanize : "False", "#", class: "dropdown__toggle", data: { action: "toggle-dropdown" } %>

              <div class="dropdown__content" data-dropdown-content>
                <%= link_to "True", build_filter_path(:expired, "true"), class: "dropdown__item" %>
                <%= link_to "False", build_filter_path(:expired, nil), class: "dropdown__item" %>
              </div>
            </div>
          </div>
        </div>

        <div class="filter">
          <div class="filter__item">
            <span class="filter__label"><%= t "filter.author" %></span>

            <div class="dropdown" data-dropdown>
              <%= link_to params[:author] ? params[:author].split("#")[0] : t("filter.select"), "#", class: "dropdown__toggle", data: { action: "toggle-dropdown get-verified-users" } %>

              <div class="dropdown__content" data-dropdown-content>
                <% if params[:author] %>
                  <%= link_to t("filter.remove"), build_filter_path(:author, nil), class: "dropdown__item" %>
                  <hr>
                <% end %>

                <span class="dropdown__label"><small><%= t "filter.verified_authors" %></small></span>

                <div data-role="filter-authors">
                  <span class="dropdown__item text-base"><div class="spinner spinner--small"></div></span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="filter__actions">
        <% if params[:from] || params[:to] || params[:sort] || params[:expired] || params[:map] || params[:hero] || params[:category] || params[:author] %>
          <%= link_to t("filter.remove_all"), params[:search] ? "/search/#{ params[:search] }" : posts_path(1), class: "filter__link filter__link--remove" %>
        <% end %>

        <%= button_tag "#{ params[:from].nil? && params[:to].nil? && params[:sort].nil? && params[:expired].nil? && params[:author].nil?  ? "+ More filters" : "- Less filters" }", class: "filter__link",
                       data: { action: "toggle-content", hide_with: "+ More filters", show_with: "- Less filters" } %>
      </div>
    </div>
  </nav>
<% end %>
