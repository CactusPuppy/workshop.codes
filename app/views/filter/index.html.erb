<% if params[:search] %>
  <% content_for :page_title, "#{ params[:search] }" %>
<% elsif params[:category] %>
  <% content_for :page_title, "#{ params[:category].gsub("-", " ").split.map(&:capitalize).join(" ") }" %>
<% elsif params[:hero] %>
  <% content_for :page_title, "#{ params[:hero].gsub("-", " ").split.map(&:capitalize).join(" ") }" %>
<% elsif params[:map] %>
  <% content_for :page_title, "#{ params[:map].gsub("-", " ").split.map(&:capitalize).join(" ") }" %>
<% end %>

<div class="heading"></div>

<% if params[:search].present? && @users.present? && @users.any? %>
  <h2>Creators for <strong><%= CGI.unescape(params[:search]) %></strong></h2>
  <% @users.each do |user| %>
    <%= render "profiles/profile", user: user, small: true %>
  <% end %>
<% end %>

<h2 class="<%= "mt-1/1" if @users.present? && @users.any? %>">
  <% if flash[:error] %>
    Something went wrong while performing your search.
  <% else %>
    Workshop Codes
    <% if params[:search] %> for <strong><%= CGI.unescape(params[:search]) %></strong> <% end %>
    <% if params[:category] %> in <strong><%= params[:category].gsub("-", " ").split.map(&:capitalize).join(" ") %></strong> <% end %>
    <% if params[:hero] %> with <strong><%= params[:hero].gsub("-", " ").split.map(&:capitalize).join(" ") %></strong> <% end %>
    <% if params[:map] %> on <strong><%= params[:map].gsub("-", " ").split.map(&:capitalize).join(" ") %></strong> <% end %>
    <% if params[:sort] %> sorted by <strong><%= params[:sort].gsub("-", " ") %></strong> <% end %>
    <% if params[:author] %> by <strong><%= params[:author].split("#")[0] %></strong> <% end %>
    <%= tag.small "- Page #{ params[:page] }" if params[:page] %>
  <% end %>
</h2>

<div class="hero-grid mb-1/4" data-expandable-content>
  <div class="hero-grid__content">
    <% heroes.group_by { |item| item["category"] }.each do |hero_category, heroes| %>
      <% heroes.each do |hero| %>
        <%= link_to image_tag(hero_name_to_icon_url(hero["name"]), width: 50, height: 50),
                    build_filter_path(:hero, params[:hero] && params[:hero] == to_slug(hero["name"]) ? nil : to_slug(hero["name"])),
                    class: "hero-grid__item #{ "hero-grid__item--inactive" if params[:hero] && params[:hero] != to_slug(hero["name"]) }",
                    data: { prefetch: false } %>
      <% end %>
    <% end %>
  </div>

  <div class="hero-grid__expand">
    <button class="button button--secondary button--small" data-action="expand-content">Show more</button>
  </div>
</div>

<%= render "filter/filter_content", classes: "filter__group--light p-0", show_players: false, show_submit: false, show_heroes: false, direct: true %>

<div class="mb-1/4"></div>

<%= render "posts/posts", disable_cache: true %>
