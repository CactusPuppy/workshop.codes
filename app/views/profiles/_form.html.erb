<%= form_for @user, url: profile_path(@user.username) do |f| %>
  <% if @user.errors.any? %>
    <div class="error-block">
      <h2 class="error-block__title"><strong><%= pluralize(@user.errors.count, "error") %></strong> prohibited this user from being saved:</h2>

      <ul>
        <% @user.errors.full_messages.each do |message| %>
          <li><small><%= message %></small></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <% if !@user.provider_profile_image.present? %>
    <div class="form-group-max-width mt-full">
      <%= f.label :profile_image, "Profile image", class: "form-label" %>
      <% begin %>
        <%= image_tag @user.profile_image.variant(quality: 95, resize_to_fill: [140, 140]).processed, class: "profile-image" if @user.profile_image.attached? %>
      <% rescue%>
      <% end %>
      <%= f.file_field :profile_image, accept: "image/png, image/jpeg, image/jpg" %>

      <p class="form-hint mt-quarter">
        The image will be processed to a 140x140 format. Max 2MB.
      </p>
    </div>
  <% else %>
    <%= f.label :profile_image, "Profile image", class: "form-label" %>
    <%= image_tag @user.provider_profile_image, class: "profile-image" %>

    <p class="form-hint mt-quarter">
      This image is directly from Discord. Adjusting your profile picture on Discord will also change it here.
    </p>
  <% end %>

  <div class="form-group-max-width mt-full">
    <%= f.label :featured_posts, "Featured Codes", class: "form-label" %>

    <div class="form-hint">
      Show up to 3 Featured Codes on your Profile page.
    </div>

    <% if @user.posts.any? %>
      <%= f.select :featured_posts, @user.posts.collect {|p| [ p.title, p.id ] }, { include_hidden: false }, { multiple: true, size: 5, class: "form-select" } %>
    <% else %>
      <p>You've not yet posted anything.</p>
    <% end %>
  </div>

  <div class="form-group mt-full">
    <%= f.label :description, "About you", class: "form-label" %>

    <div class="form-hint">
      Write a little bit about yourself. Share your Battle tag, platform, or other places people can find you.<br>
      Full markdown enabled. Limited to 255 characters.
    </div>

    <%= f.text_area :description, class: "form-input form-textarea form-textarea--extra-small" %>
  </div>

  <div class="form-group-max-width mt-full">
    <%= f.label :link, class: "form-label" %>
    <p class="form-hint">
      Link to your website/discord/whatever you might want people to visit. Links should start with <code>http://</code> or <code>https://</code>.
    </p>

    <%= f.text_field :link, placeholder: "Link", class: "form-input" %>
  </div>

  <hr class="small mt-full">

  <%= submit_tag "Submit", class: "button" %>
<% end %>
