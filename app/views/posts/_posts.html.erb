<% display_type ||= "list" %>

<% cache_unless current_user, [current_locale, @posts] do %>
  <main class="<%= display_type == "list" ? "items" : "cards" %>">
    <% if @posts.any? %>
      <% if display_type == "list" %>
        <%= render @posts %>
      <% else %>
        <%= render collection: @posts, partial: "posts/card", as: :post  %>
      <% end %>

      <% if @posts.size == 20 %>
        <div class="infinite-scroll" data-role="infinite-scroll-marker" data-load-method="infinite-scroll" data-url="<%= request.original_url %>"></div>

        <div class="flex justify-center" data-role="infinite-scroll-backup-pagination">
          <%= paginate @posts %>
        </div>
      <% end %>
    <% else %>
      <% if flash[:error] %>
        <div><button class="button" onclick="location.reload()">Try again?</button></div>
      <% else %>
        <p><em>There doesn't seem to be anything here</em></p>
      <% end %>

      <blockquote>
        <% quote = quotes.sample %>
        <em><%= quote["quote"] %></em>
        -&nbsp;<%= quote["by"] %>
      </blockquote>
    <% end %>
  </main>
<% end %>
